{"title":"JavaScript设计模式之观察者模式","date":"2020-07-25T13:12:22.000Z","date_formatted":{"ll":"Jul 25, 2020","L":"07/25/2020","MM-DD":"07-25"},"link":"2020/07/25/JavaScript设计模式之观察者模式","tags":["设计模式"],"updated":"2022-01-22T09:45:40.641Z","content":"<h3 id=\"发布-订阅模式\">发布-订阅模式<a title=\"#发布-订阅模式\" href=\"#发布-订阅模式\"></a></h3>\n<p>发布订阅模式又称为观察者模式，它定义了对象间的一种一对多的依赖关系，当一个对象发生改变时，所有依赖与它的对象都会得到通知。在前端开发中，DOM事件是一个典型的发布-订阅模型。比如我们监听一个点击事件，设置一个回调函数负责收到通知。<br>\n现在来看看如何来实现一个JavaScript版的发布-订阅模式<br>\n先实现一个发布者工厂：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> event = &#123;</span><br><span class=\"line\">    <span class=\"attr\">clientList</span>:[],</span><br><span class=\"line\">    <span class=\"title function_\">subscribe</span>(<span class=\"params\">key,fn</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"variable language_\">this</span>.<span class=\"property\">clientList</span>[key]) &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">clientList</span>[key] = []</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">clientList</span>[key].<span class=\"title function_\">push</span>(fn)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">trigger</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> key = <span class=\"title class_\">Array</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">shift</span>.<span class=\"title function_\">call</span>(<span class=\"variable language_\">arguments</span>),</span><br><span class=\"line\">        fns = <span class=\"variable language_\">this</span>.<span class=\"property\">clientList</span>[key];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fns||fns.<span class=\"property\">length</span>===<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i=<span class=\"number\">0</span>,fn;fn = fns[i++];)&#123;</span><br><span class=\"line\">            fn.<span class=\"title function_\">apply</span>(<span class=\"variable language_\">this</span>,<span class=\"variable language_\">arguments</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">unsubscribe</span>(<span class=\"params\">key,fn</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fns = <span class=\"variable language_\">this</span>.<span class=\"property\">clientList</span>[key];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fns)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!fn)&#123;</span><br><span class=\"line\">            fns&amp;&amp;(fns.<span class=\"property\">length</span>=<span class=\"number\">0</span>)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> l = fns.<span class=\"property\">length</span>-<span class=\"number\">1</span>;l&gt;=<span class=\"number\">0</span>;l--)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> _fn = fns[l];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(_fn===fn)&#123;</span><br><span class=\"line\">                    fns.<span class=\"title function_\">splice</span>(l,<span class=\"number\">1</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在这个发布者工厂里我们先是定义个<code>subscribe</code>函数来对特定的属性进行订阅，并将订阅者存在属性订阅者列表中。接着定义一个<code>trigger</code>用来发布通知给所有的订阅者，接下来是一个<code>unsubscribe</code>来取消订阅，对对应属性的特定订阅者取消该属性的订阅。</p>\n<p>接着写一个给对象布置“发布-订阅”功能的函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> installEvent = <span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">let</span> i <span class=\"keyword\">in</span> event)&#123;</span><br><span class=\"line\">        obj[i] = event[i]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//测试</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title function_\">xiaoming</span> = (<span class=\"params\">price</span>)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;apple-price&quot;</span>,price)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title function_\">xiaoHong</span> =(<span class=\"params\">price</span>)=&gt;&#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;banana-price&quot;</span>,price)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sales.<span class=\"title function_\">subscribe</span>(<span class=\"string\">&quot;apple&quot;</span>,xiaoming)</span><br><span class=\"line\">sales.<span class=\"title function_\">subscribe</span>(<span class=\"string\">&quot;banana&quot;</span>,xiaoHong)</span><br><span class=\"line\">sales.<span class=\"title function_\">trigger</span>(<span class=\"string\">&quot;apple&quot;</span>,<span class=\"number\">500</span>)<span class=\"comment\">//apple-price 500</span></span><br><span class=\"line\">sales.<span class=\"title function_\">trigger</span>(<span class=\"string\">&quot;banana&quot;</span>,<span class=\"number\">600</span>)<span class=\"comment\">//banana-price 600</span></span><br><span class=\"line\">sales.<span class=\"title function_\">trigger</span>(<span class=\"string\">&quot;apple&quot;</span>,<span class=\"number\">1200</span>)<span class=\"comment\">//apple-price 1200</span></span><br><span class=\"line\">sales.<span class=\"title function_\">unsubscribe</span>(<span class=\"string\">&quot;apple&quot;</span>,xiaoming)<span class=\"comment\">//取消订阅</span></span><br><span class=\"line\">sales.<span class=\"title function_\">trigger</span>(<span class=\"string\">&quot;apple&quot;</span>,<span class=\"number\">1</span>)<span class=\"comment\">//</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>以上就实现了一个简单的发布-订阅模式</p>\n<h3 id=\"vue中的发布-订阅\">Vue中的发布-订阅<a title=\"#vue中的发布-订阅\" href=\"#vue中的发布-订阅\"></a></h3>\n<p>发布-订阅在目前的前端框架有诸多的应用，常见的是Vue2.0的双向绑定就利用了观察者模式<br>\n在Vue2.0中使用<code>Object.defineProperty</code>对数据的属性进行劫持可以收到数据更改的消息，而如何通知视图更新呢，Vue中定义了一个依赖类：<code>dep</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 源码位置：src/core/observer/dep.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Dep</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span> = []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  addSub (sub) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">push</span>(sub)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 删除一个依赖</span></span><br><span class=\"line\">  removeSub (sub) &#123;</span><br><span class=\"line\">    <span class=\"title function_\">remove</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>, sub)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 添加一个依赖</span></span><br><span class=\"line\">  depend () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">window</span>.<span class=\"property\">target</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"title function_\">addSub</span>(<span class=\"variable language_\">window</span>.<span class=\"property\">target</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 通知所有依赖更新</span></span><br><span class=\"line\">  notify () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> subs = <span class=\"variable language_\">this</span>.<span class=\"property\">subs</span>.<span class=\"title function_\">slice</span>()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>, l = subs.<span class=\"property\">length</span>; i &lt; l; i++) &#123;</span><br><span class=\"line\">      subs[i].<span class=\"title function_\">update</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Remove an item from an array</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">remove</span> (arr, item) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (arr.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = arr.<span class=\"title function_\">indexOf</span>(item)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &gt; -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> arr.<span class=\"title function_\">splice</span>(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在上面的依赖管理器Dep类中，我们先初始化了一个subs数组，用来存放依赖，并且定义了几个实例方法用来对依赖进行添加，删除，通知等操作。</p>\n<p>有了依赖管理器后，我们就可以在getter中收集依赖，在setter中通知依赖更新了，代码如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">defineReactive</span> (obj,key,val) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable language_\">arguments</span>.<span class=\"property\">length</span> === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    val = obj[key]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> val === <span class=\"string\">&#x27;object&#x27;</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">Observer</span>(val)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dep = <span class=\"keyword\">new</span> <span class=\"title class_\">Dep</span>()  <span class=\"comment\">//实例化一个依赖管理器，生成一个依赖管理数组dep</span></span><br><span class=\"line\">  <span class=\"title class_\">Object</span>.<span class=\"title function_\">defineProperty</span>(obj, key, &#123;</span><br><span class=\"line\">    <span class=\"attr\">enumerable</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">configurable</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"title function_\">get</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">      dep.<span class=\"title function_\">depend</span>()    <span class=\"comment\">// 在getter中收集依赖</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> val;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"title function_\">set</span>(<span class=\"params\">newVal</span>)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(val === newVal)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      val = newVal;</span><br><span class=\"line\">      dep.<span class=\"title function_\">notify</span>()   <span class=\"comment\">// 在setter中通知依赖更新</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其实在Vue中还实现了一个叫做<code>Watcher</code>的类，而<code>Watcher</code>类的实例就是我们上面所说的那个&quot;谁&quot;。换句话说就是：谁用到了数据，谁就是依赖，我们就为谁创建一个<code>Watcher</code>实例。在之后数据变化时，我们不直接去通知依赖更新，而是通知依赖对应的<code>Watch</code>实例，由<code>Watcher</code>实例去通知真正的视图。</p>\n<p><code>Watcher</code>类的具体实现如下：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Watcher</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span> (vm,expOrFn,cb) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span> = vm;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">cb</span> = cb;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">getter</span> = <span class=\"title function_\">parsePath</span>(expOrFn)</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">get</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  get () &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"property\">target</span> = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> vm = <span class=\"variable language_\">this</span>.<span class=\"property\">vm</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> value = <span class=\"variable language_\">this</span>.<span class=\"property\">getter</span>.<span class=\"title function_\">call</span>(vm, vm)</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"property\">target</span> = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  update () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> oldValue = <span class=\"variable language_\">this</span>.<span class=\"property\">value</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">value</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">get</span>()</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">cb</span>.<span class=\"title function_\">call</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">vm</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">value</span>, oldValue)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Parse simple path.</span></span><br><span class=\"line\"><span class=\"comment\"> * 把一个形如&#x27;data.a.b.c&#x27;的字符串路径所表示的值，从真实的data对象中取出来</span></span><br><span class=\"line\"><span class=\"comment\"> * 例如：</span></span><br><span class=\"line\"><span class=\"comment\"> * data = &#123;a:&#123;b:&#123;c:2&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * parsePath(&#x27;a.b.c&#x27;)(data)  // 2</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> bailRE = <span class=\"regexp\">/[^\\w.$]/</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">parsePath</span> (path) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (bailRE.<span class=\"title function_\">test</span>(path)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> segments = path.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">function</span> (<span class=\"params\">obj</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; segments.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!obj) <span class=\"keyword\">return</span></span><br><span class=\"line\">      obj = obj[segments[i]]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>此处附上一张Vue双向绑定的图解<br>\n<img src=\"/images/Vue.jpg\" alt=\"Vue\" loading=\"lazy\"></p>\n","prev":{"title":"Rust学习小记录","link":"2020/10/03/Rust学习小记录"},"next":{"title":"手动实现的call,apply,bind,new","link":"2020/06/27/手动实现的call-apply-bind-new"},"plink":"https://edsion11.github.io/2020/07/25/JavaScript设计模式之观察者模式/","toc":[{"id":"发布-订阅模式","title":"发布-订阅模式","index":"1"},{"id":"vue中的发布-订阅","title":"Vue中的发布-订阅","index":"2"}],"copyright":{"author":"Edsion Gu","link":"<a href=\"https://edsion11.github.io/2020/07/25/JavaScript设计模式之观察者模式/\" title=\"JavaScript设计模式之观察者模式\">https://edsion11.github.io/2020/07/25/JavaScript设计模式之观察者模式/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}