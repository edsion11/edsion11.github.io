{"title":"Typescript相关","date":"2021-02-21T20:37:20.000Z","date_formatted":{"ll":"Feb 21, 2021","L":"02/21/2021","MM-DD":"02-21"},"link":"2021/02/21/Typescript相关","tags":["Typescript"],"categories":["Typescript"],"updated":"2022-01-22T09:45:40.641Z","content":"<p>最近复习基础看到了Learning Typescript这本书，翻开学习，发现了不少知识，在此记录一下。</p>\n<h4 id=\"面向对象编程\">面向对象编程<a title=\"#面向对象编程\" href=\"#面向对象编程\"></a></h4>\n<h4 id=\"solid原则\">SOLID原则<a title=\"#solid原则\" href=\"#solid原则\"></a></h4>\n<p>利用Typescript进行面向对象编程要注意五个点，简称为“SOLID”原则</p>\n<ul>\n<li>单一职责原则(SRP): 表明软件组件(函数，类，模块)必须专注于单一的任务(只有单一的职责)</li>\n<li>开/闭原则(OCP): 表明软件设计时必须时刻考虑到(代码)可能的发展(具有扩展性)，但是程序的发展必须最少地修改已有的代码(对已有的修改封闭)<br>\n-里氏替换原则(LSP): 表明只要继承的是同一个接口，程序里任意一个类都可以被其他的类替换。在替换完成后，不需要其他额外的工作程序就能像原来一样运行。<br>\n-接口隔离原则(ISP): 表明我们应该将那些非常大的接口拆分成一些更具体的接口，这样客户端就只需要关心他们需要用到的接口<br>\n-依赖反转原则(DIP): 表明一个方法应该遵从依赖于抽象（接口）而不是一个实例（类）的概念。<br>\n用<code>Typesciript</code>编写一个类如下：</li>\n</ul>\n <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>&#123;</span><br><span class=\"line\">    public <span class=\"attr\">name</span>: string;</span><br><span class=\"line\">    public <span class=\"attr\">surname</span>: string;</span><br><span class=\"line\">    public <span class=\"attr\">email</span>: string;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">name: string, surname: string, email: string</span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">email</span> = email;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">surname</span> = surname;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">greet</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p : <span class=\"title class_\">Person</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>(<span class=\"string\">&quot;liming&quot;</span>, <span class=\"string\">&quot;li&quot;</span>, <span class=\"string\">&quot;123@163.com&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>如果要验证<code>email</code>的格式，在<code>Person</code>上增加代码会使<code>Person</code>类变得非常大，我们可以八<code>email</code>抽象成一个类分离出来，这体现了第一个单一职责原则。</p>\n <figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Email</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"attr\">email</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">email: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">this</span>.<span class=\"title function_\">validateEmail</span>(email))&#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">email</span> = email</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Error</span>(<span class=\"string\">&quot;Invalid email!&quot;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">validateEmail</span>(<span class=\"params\">email: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> re = <span class=\"string\">&#x27;/\\S+@\\S+\\.\\S+/&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> re.<span class=\"title function_\">test</span>(email)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">public</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">       <span class=\"keyword\">public</span> <span class=\"attr\">surname</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">       <span class=\"keyword\">public</span> <span class=\"attr\">email</span>: <span class=\"title class_\">Email</span>;</span><br><span class=\"line\">       <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, surname: <span class=\"built_in\">string</span>, email: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">           <span class=\"variable language_\">this</span>.<span class=\"property\">email</span> = email;</span><br><span class=\"line\">           <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name;</span><br><span class=\"line\">           <span class=\"variable language_\">this</span>.<span class=\"property\">surname</span> = surname;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"title function_\">greet</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">           <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<p>在面向对象的过程中，类与类有一些关系，比如关联，聚合，组合，继承，混合等，接下来并不介绍他们的概念，而是介绍一下泛型类和泛型约束</p>\n<h4 id=\"泛型类\">泛型类<a title=\"#泛型类\" href=\"#泛型类\"></a></h4>\n<p>泛型类如同泛型函数，可以介绍很多重复的代码，接下来用代码说明<br>\n首先是一个类<br>\n<img src=\"/images/typescript/ts_1.png\" alt=\"代码\" loading=\"lazy\"><br>\n这里包括一个<code>User</code>的类和一个<code>NotGenericUserRepository</code>的类，后面这个类是获取User的列表，并传给JSON文件，当我们想获取一个会议，或者一个歌曲列表时，不同的类形成的这个<code>GenericRepository</code>类也就要重写，这时可以利用泛型类。如下所示：<br>\n<img src=\"/images/typescript/ts_2.png\" alt=\"代码\" loading=\"lazy\"><br>\n有时候，我们需要泛型约束，如上述例子，新需求是增加一些变更来验证通过Ajax请求的数据:</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">data</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"attr\">list</span>: T[]</span><br><span class=\"line\">    <span class=\"keyword\">var</span> items = &lt;T[]&gt;data.items</span><br><span class=\"line\">    for(let i=0;i&lt;items.length;i++)&#123;</span><br><span class=\"line\">        if(items[i].isValid())&#123; // 验证</span><br><span class=\"line\">            // ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    resolve(list)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>那我们可以写一个验证接口，将泛型进行约束：</p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">User</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ValidatableInterface</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"attr\">password</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, password: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">password</span> = password</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">isValid</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Talk</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ValidatableInterface</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"attr\">name</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, password: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">name</span> = name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">isValid</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">NotGenericUserRepository</span>&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">ValidatableInterface</span>&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"attr\">_url</span>: <span class=\"built_in\">string</span></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\">url: <span class=\"built_in\">string</span></span>)&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">_url</span> = url</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">getAsync</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve: (users: T[]) =&gt; <span class=\"built_in\">void</span>. reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            $.<span class=\"title function_\">ajax</span>(&#123;</span><br><span class=\"line\">                <span class=\"attr\">url</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">_url</span>,</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">dataType</span>: <span class=\"string\">&quot;JSON&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">data</span>)=&gt;</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> <span class=\"attr\">list</span>: T[]</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> items = &lt;T[]&gt;data.items</span><br><span class=\"line\">                    for(let i=0;i&lt;items.length;i++)&#123;</span><br><span class=\"line\">                        if(items[i].isValid())&#123;</span><br><span class=\"line\">                            list.push(items[i])</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    resolve(list)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                error: (e)=&gt;&#123;</span><br><span class=\"line\">                    reject(e)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;class User implements ValidatableInterface&#123;</span><br><span class=\"line\">    public name: string</span><br><span class=\"line\">    public password: string</span><br><span class=\"line\">    constructor(name: string, password: string)&#123;</span><br><span class=\"line\">        this.name = name</span><br><span class=\"line\">        this.password = password</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public isValid()&#123;</span><br><span class=\"line\">        // ...</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class Talk implements ValidatableInterface&#123;</span><br><span class=\"line\">    public name: string</span><br><span class=\"line\">    constructor(name: string, password: string)&#123;</span><br><span class=\"line\">        this.name = name</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public isValid()&#123;</span><br><span class=\"line\">        // ...</span><br><span class=\"line\">        return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class NotGenericUserRepository&lt;T extends ValidatableInterface&gt;&#123;</span><br><span class=\"line\">    private _url: string</span><br><span class=\"line\">    constructor(url: string)&#123;</span><br><span class=\"line\">        this._url = url</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public getAsync()&#123;</span><br><span class=\"line\">        return new Promise((resolve: (users: T[]) =&gt; void. reject) =&gt; &#123;</span><br><span class=\"line\">            $.ajax(&#123;</span><br><span class=\"line\">                url: this._url,</span><br><span class=\"line\">                type: &quot;GET&quot;,</span><br><span class=\"line\">                dataType: &quot;JSON&quot;,</span><br><span class=\"line\">                success: (data)=&gt;&#123;</span><br><span class=\"line\">                    var list: T[]</span><br><span class=\"line\">                    var items = &lt;T[]&gt;data.items</span><br><span class=\"line\">                    for(let i=0;i&lt;items.length;i++)&#123;</span><br><span class=\"line\">                        if(items[i].isValid())&#123;</span><br><span class=\"line\">                            list.push(items[i])</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    resolve(list)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                error: (e)=&gt;&#123;</span><br><span class=\"line\">                    reject(e)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"泛型中的new操作\">泛型中的new操作<a title=\"#泛型中的new操作\" href=\"#泛型中的new操作\"></a></h4>\n<p>要通过代码来创建新的对象，我们需要声明泛型T拥有构造函数，这意味着我们需要像下面一样，用<code>type: &#123;new() :T;&#125;</code>替代<code>type:T</code><br>\n<img src=\"/images/typescript/ts_4.png\" alt=\"代码\" loading=\"lazy\"></p>\n<h4 id=\"\"><a title=\"#\" href=\"#\"></a></h4>\n","prev":{"title":"有关Angular新一代编译引擎Ivy的介绍","link":"2021/07/22/有关Angular新一代编译引擎Ivy的介绍"},"next":{"title":"前端项目服务端渲染（SSR）","link":"2021/02/15/前端项目服务端渲染（SSR）"},"plink":"https://edsion11.github.io/2021/02/21/Typescript相关/","toc":[{"id":"面向对象编程","title":"面向对象编程","index":"1"},{"id":"solid原则","title":"SOLID原则","index":"2"},{"id":"泛型类","title":"泛型类","index":"3"},{"id":"泛型中的new操作","title":"泛型中的new操作","index":"4"},{"id":"","title":"","index":"5"}],"copyright":{"author":"Edsion Gu","link":"<a href=\"https://edsion11.github.io/2021/02/21/Typescript相关/\" title=\"Typescript相关\">https://edsion11.github.io/2021/02/21/Typescript相关/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}